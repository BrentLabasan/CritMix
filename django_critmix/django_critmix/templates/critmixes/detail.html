{% load staticfiles %}
<html>
<head>

<style type="text/css">
body {
font-family: Arial;
}
.button {
color: white;
background-color: blue;
padding: 10px;
font-size: 10px;
}
</style>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<!-- SoundCloud -->
<script src="http://connect.soundcloud.com/sdk.js"></script>
<script src="http://w.soundcloud.com/player/api.js" type="text/javascript"></script>
<!-- Almende Timeline -->
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script src="{% static "timeline-2.3.2/timeline.js" %}" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="{% static "timeline-2.3.2/timeline.css" %}">

<script type="text/javascript">

var critList = new Object(); // doesn't work when placed in document.ready, weird!

/*
0 mix too muddy
10 bass too muddy 11 mids too muddy 12 treble too muddy
20 vocals 21 kick 22 snare 23 subbass
30 transition
*/

function makeCrit(id, critType, timePosition, comment) {
  //$('#critsHolder').append(timePosition + " " + critType + " " + comment + "</br>");
  console.log(timePosition + " " + critType + " " + comment);
  critList[randomID] = {
    id: id,
    critType: critType,
    timePosition: timePosition,
    comment: comment
  }
}



      

$(document).ready(function() {

var iframeElement   = document.querySelector('iframe');
//var iframeElementID = iframeElement.id;
var widget        = SC.Widget(iframeElement);
//var widget2         = SC.Widget(iframeElementID);
console.log(iframeElement);
//console.log(iframeElementID);
console.log(widget);
//console.log(widget2);

widget.bind(SC.Widget.Events.READY, function() {
      console.log(SC.Widget.Events.PLAY_PROGRESS.currentPosition);
      widget.bind(SC.Widget.Events.PLAY, function() {
        // get information about currently playing sound
        widget.getCurrentSound(function(currentSound) { 
          console.log('sound ' + currentSound.get('') + 'began to play');
        });
      });
      // get current level of volume
      widget.getVolume(function(volume) {
        console.log('current volume value is ' + volume);
      });
      // set new volume level
      widget.setVolume(50);
      // get the value of the current position
       widget.getPosition(function(position) {
        console.log('current position value is ' + position);
        $('#holder_seconds').text(position);
      });
    });

widget.bind (SC.Widget.Events.PLAY_PROGRESS, function(currentPosition) {
var secs = currentPosition.currentPosition/1000 ;
$('#holder_seconds').text(secs); // works
//$('#holder_seconds').text( $('.timeIndicator__current').text() ); // span becomes blank

//http://stackoverflow.com/questions/4416505/how-to-take-keyboard-input-in-javascript/4416533#4416533


}); // PLAY_PROGRESS


document.addEventListener('keyup', function(event) { //http://stackoverflow.com/questions/1349404/generate-a-string-of-5-random-characters-in-javascript/8084248#8084248
    randomID = Math.random().toString(36).substr(2, 5) ;
    while (critList[randomID]) { // if there's already a Crit with that ID, generate a new randomID
      randomID = Math.random().toString(36).substr(2, 5) ;
    }
    currTime = $('#holder_seconds').text()

    switch (event.keyCode) {
      case 65:
        critType = 20;
        break;
      case 83:
        critType = 10;
        break;
      default:
        
    }

    switch (critType) {
      case 20:
        // makeCrit(id, critType, timePosition, comment)
        makeCrit(randomID, 20, currTime, 'Vocals Unclear')
        break;
      case 10:
        makeCrit(randomID, 10, currTime, 'Bass Unclear')
        break;
      default:
        
    }

});



}); // .ready

</script>

<script type="text/javascript">
      var timeline;
      
      google.load("visualization", "1");
      
      // Set callback to run when API is loaded
      google.setOnLoadCallback(drawVisualization); 

      // Called when the Visualization API is loaded.
      function drawVisualization() {
        // Create and populate a data table.
        var data = new google.visualization.DataTable();
        data.addColumn('datetime', 'start');
        data.addColumn('datetime', 'end');
        data.addColumn('string', 'content');
  
  /*
        data.addRows([
          [new Date(2010,7,23), , 'Conversation<br>' + 
            '<img src="img/comments-icon.png" style="width:32px; height:32px;">'],
          [new Date(2010,7,23,23,0,0), , 'Mail from boss<br>' + 
            '<img src="img/mail-icon.png" style="width:32px; height:32px;">'],
          [new Date(2010,7,24,16,0,0), , 'Report'],
          [new Date(2010,7,26), new Date(2010,8,2), 'Traject A'],     
          [new Date(2010,7,28), , 'Memo<br>' + 
            '<img src="img/notes-edit-icon.png" style="width:48px; height:48px;">'],
          [new Date(2010,7,29), , 'Phone call<br>' + 
            '<img src="img/Hardware-Mobile-Phone-icon.png" style="width:32px; height:32px;">'],
          [new Date(2010,7,31), new Date(2010,8,3), 'Traject B'],     
          [new Date(2010,8,4,12,0,0), , 'Report<br>' +
            '<img src="img/attachment-icon.png" style="width:32px; height:32px;">']
        ]);
*/

///*
chee = new Date(2010,7,15,0,30);
data.addRows([
          [new Date(2010,7,15,0,30), , chee.toString()],
        ]);
//*/
        // specify options
        var options = {
          "editable": true,
          "width":  "100%", 
          "height": "300px", 
          "style": "box",
          "intervalMin": 86400000,
          "intervalMax": 86400000,
          "min": new Date(2010, 7, 15,0,0),
          "max": new Date(2010, 7, 15,1,0),
          //"scale": "SCALE.YEAR",
          //"step": "5",
          //"zoomable": true,
        };

        // Instantiate our timeline object.
        timeline = new links.Timeline(document.getElementById('mytimeline'));
        
        // Draw our timeline with the created data and options 
        timeline.draw(data, options);
        //timeline.deleteAllItems(); // works
        //timeline.setScale(SCALE.MINUTES, 2);
        timeline.setScale(links.Timeline.StepDate.SCALE.HOUR, 1);
      }
   </script>

</head>
<body>

<h1>{{ critmix }}</h1>

<div id="SCholder">{{ embed_info|safe }}</div>
<div id="holder_seconds">Position: <span id="sec">test1</span></div>
<br/><br/><br/>
<div>

<span id="" class="button">(A) Vocals Unclear</span>
<span id="" class="button">(S) Bass Unclear</span>
<span id="" class="button">(D) Mids Unclear</span>
<span id="" class="button">(F) Treble Unclear</span>
<span id="" class="button">(G) Go 5 Seconds Back</span>

<span id="" class="button">(H) Go 5 Seconds Forward</span>
<span id="" class="button">(J) Kick Drum</span>
<span id="" class="button">(K) Snare Drum</span>
<span id="" class="button">(L) Section Transition</span>
<span id="" class="button">(;) Subbass</span>

</div>

<div id="critsHolder">

</div>

<div id="mytimeline"></div>

</body>
</html>

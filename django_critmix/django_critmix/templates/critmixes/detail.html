<html>
<head>

<style type="text/css">
body {
font-family: Arial;
}
.button {
color: white;
background-color: blue;
padding: 10px;
font-size: 10px;
}
</style>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="http://connect.soundcloud.com/sdk.js"></script>
<script src="http://w.soundcloud.com/player/api.js" type="text/javascript"></script>
<script>

var dict = new Object(); // doesn't work when placed in document.ready, weird!

$(document).ready(function() {

var iframeElement   = document.querySelector('iframe');
//var iframeElementID = iframeElement.id;
var widget        = SC.Widget(iframeElement);
//var widget2         = SC.Widget(iframeElementID);
console.log(iframeElement);
//console.log(iframeElementID);
console.log(widget);
//console.log(widget2);

widget.bind(SC.Widget.Events.READY, function() {
      console.log(SC.Widget.Events.PLAY_PROGRESS.currentPosition);
      widget.bind(SC.Widget.Events.PLAY, function() {
        // get information about currently playing sound
        widget.getCurrentSound(function(currentSound) { 
          console.log('sound ' + currentSound.get('') + 'began to play');
        });
      });
      // get current level of volume
      widget.getVolume(function(volume) {
        console.log('current volume value is ' + volume);
      });
      // set new volume level
      widget.setVolume(50);
      // get the value of the current position
       widget.getPosition(function(position) {
        console.log('current position value is ' + position);
        $('#holder_seconds').text(position);
      });
    });

widget.bind (SC.Widget.Events.PLAY_PROGRESS, function(currentPosition) {
var secs = currentPosition.currentPosition/1000 ;
$('#holder_seconds').text(secs); // works
//$('#holder_seconds').text( $('.timeIndicator__current').text() ); // span becomes blank

//http://stackoverflow.com/questions/4416505/how-to-take-keyboard-input-in-javascript/4416533#4416533


}); // PLAY_PROGRESS

//http://stackoverflow.com/questions/1349404/generate-a-string-of-5-random-characters-in-javascript/8084248#8084248
// Math.random().toString(36).substr(2, 5)

document.addEventListener('keyup', function(event) {
    randomID = Math.random().toString(36).substr(2, 5) ;
    while (dict[randomID]) { // if there's already a Crit with that ID, generate a new randomID
      randomID = Math.random().toString(36).substr(2, 5) ;
    }
    bleh = $('#holder_seconds').text()
    if(event.keyCode == 65) {
        console.log('Left was pressed');
        $('#critsHolder').append(bleh + ' Vocals Unclear</br>');
        dict[randomID] = randomID;
    }
    else if(event.keyCode == 83) {
        console.log('Right was pressed');
        $('#critsHolder').append(bleh + ' Bass Unclear</br>');
        dict[randomID] = randomID;
    }
});

});

</script>

</head>
<body>

<h1>{{ critmix }}</h1>

<div id="SCholder">{{ embed_info|safe }}</div>
<div id="holder_seconds">Position: <span id="sec">test1</span></div>
<br/><br/><br/>
<div>

<span id="" class="button">(A) Vocals Unclear</span>
<span id="" class="button">(S) Bass Unclear</span>
<span id="" class="button">(D) Mids Unclear</span>
<span id="" class="button">(F) Treble Unclear</span>
<span id="" class="button">(G) Go 5 Seconds Back</span>

<span id="" class="button">(H) Go 5 Seconds Forward</span>
<span id="" class="button">(J) Kick Drum</span>
<span id="" class="button">(K) Snare Drum</span>
<span id="" class="button">(L) Section Transition</span>
<span id="" class="button">(;) Subbass</span>

</div>

<div id="critsHolder">

</div>

</body>
</html>
